# WazuhCluster with authd password authentication
# Demonstrates: password-based agent enrollment via secret reference
apiVersion: resources.wazuh.com/v1alpha1
kind: WazuhCluster
metadata:
  name: wazuh-authd-password
  namespace: wazuh
spec:
  version: "4.9.0"

  manager:
    config:
      auth:
        disabled: false
        port: 1515
        useSourceIP: false
        purge: true
        # Enable password authentication for agent enrollment
        usePassword: true
        # Reference to secret containing the authd password
        passwordSecretRef:
          name: wazuh-authd-password
          key: password
        enabledOnMasterOnly: true

    master:
      storageSize: "50Gi"

    workers:
      replicas: 2
      storageSize: "50Gi"

  indexer:
    replicas: 3
    storageSize: "50Gi"

  dashboard:
    replicas: 1
---
# Secret containing the authd password
# Agents will need this password to enroll
apiVersion: v1
kind: Secret
metadata:
  name: wazuh-authd-password
  namespace: wazuh
type: Opaque
stringData:
  password: "MySecureAgentEnrollmentPassword123!"
